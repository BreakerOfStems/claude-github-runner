[Unit]
Description=Claude GitHub Runner - tick cycle
Documentation=https://github.com/anthropics/claude-github-runner
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
User=claude
Group=claude
WorkingDirectory=/home/claude

# Allow forked worker processes to continue running after tick exits
# Without this, systemd's default KillMode=control-group kills all children
KillMode=process

# Main execution
ExecStart=/usr/local/bin/claude-github-runner tick

# Environment
Environment="HOME=/home/claude"
Environment="PATH=/usr/local/bin:/usr/bin:/bin"

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=claude-github-runner

# Security hardening
# Note: We can't use ProtectHome=read-only because Claude Code needs to write
# config files to the home directory (e.g., ~/.claude.json)
NoNewPrivileges=yes
ProtectSystem=strict
PrivateTmp=yes

[Install]
WantedBy=multi-user.target
